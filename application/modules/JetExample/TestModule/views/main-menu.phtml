<?php
if(!function_exists('showMenu')) {
	function showMenu( $pages ){


		if(!$pages) return;
		if($pages instanceof Jet\Data_Tree) {
			$pages = array( $pages->getRootNode() );
		}

		$current_page_ID = Jet\Mvc::getCurrentPage()->getID()->getAsMapKey();
		?>
	<ul>
		<?php foreach($pages as $page):
		/**
		 * @var Jet\Data_Tree_Node $page
		 */
		$d = $page->getData();

		if( !($URL_object = Jet\Mvc_Pages::getURLObject( $d['ID'], $d['locale'], $d['site_ID'] )) ) {
			continue;
		}

		?>
		<li>
		<?php if($current_page_ID==$URL_object->getPageID()->getAsMapKey() ): ?>
			<i><?=$URL_object->getPageMenuTitle(); ?></i>
		<?php else: ?>
			<a href="<?=$URL_object->toString(); ?>"><?=$URL_object->getPageMenuTitle(); ?></a>
		<?php endif; ?>
			<?php showMenu($page->getChildren()); ?>
		</li>
		<?php endforeach; ?>
	</ul>
	<?php
	}
}
?>

<div style="margin:5px;border-top: 1px solid black;">
	<strong>Site map [current locale: <?=Jet\Mvc::getCurrentLocale();?>]:</strong>
	<?php showMenu( $this->site_tree_current ); ?>
</div>


<?php foreach( Jet\Mvc::getCurrentLocalesList() as $locale ):
	$key = 'site_tree_'.$locale;
	?>
<div style="margin:5px;border-top: 1px solid black;">
	<strong>Site map [<?php echo $locale;?>]:</strong>
	<?php showMenu( $this->{$key} ); ?>
</div>
<?php endforeach; ?>
